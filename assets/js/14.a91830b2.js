(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{431:function(t,s,e){"use strict";e.r(s);var a=e(62),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"密码机联掉performance测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#密码机联掉performance测试"}},[t._v("#")]),t._v(" 密码机联掉performance测试")]),t._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#★配置"}},[t._v("★配置")]),e("ul",[e("li",[e("a",{attrs:{href:"#测试说明"}},[t._v("测试说明")])]),e("li",[e("a",{attrs:{href:"#环境信息"}},[t._v("环境信息")])]),e("li",[e("a",{attrs:{href:"#系统部署信息"}},[t._v("系统部署信息")])])])]),e("li",[e("a",{attrs:{href:"#★测试展示"}},[t._v("★测试展示")]),e("ul",[e("li",[e("a",{attrs:{href:"#配置1结果展示"}},[t._v("配置1结果展示")])]),e("li",[e("a",{attrs:{href:"#配置二结果展示"}},[t._v("配置二结果展示")])])])])])]),e("p"),t._v(" "),e("h2",{attrs:{id:"★配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#★配置"}},[t._v("#")]),t._v(" ★配置")]),t._v(" "),e("h3",{attrs:{id:"测试说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试说明"}},[t._v("#")]),t._v(" 测试说明")]),t._v(" "),e("img",{attrs:{src:t.$withBase("/test/vsm-process.png"),alt:"vsm-process"}}),t._v(" "),e("p",[t._v("如图所示，本测试以专用客户端"),e("strong",[t._v("Client")]),t._v("通过联掉的方式，去访问单台虚拟密码机"),e("strong",[t._v("VSM")]),t._v("。其中途径"),e("code",[t._v("scheduler-server")]),t._v("和"),e("code",[t._v("vsm-proxy")]),t._v("系统，这两个系统部署在k8s平台，客户端通过"),e("code",[t._v("Service")]),t._v("访问。")]),t._v(" "),e("h3",{attrs:{id:"环境信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境信息"}},[t._v("#")]),t._v(" 环境信息")]),t._v(" "),e("p",[e("strong",[t._v("平台地址")]),t._v("：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("master:"),e("code",[t._v("10.0.108.14")])])]),t._v(" "),e("li",[e("p",[t._v("node:"),e("code",[t._v("10.0.108.14")])])]),t._v(" "),e("li",[e("p",[t._v("架构：aarch64")])])]),t._v(" "),e("p",[e("strong",[t._v("密码机")]),t._v("：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("厂商：DA")])]),t._v(" "),e("li",[e("p",[t._v("vsmIp:"),e("code",[t._v("10.0.108.113")])])]),t._v(" "),e("li",[e("p",[t._v("密码机组："),e("code",[t._v("davsm113")])])]),t._v(" "),e("li",[e("p",[t._v("云密码机："),e("code",[t._v("10.0.130.37")])])])]),t._v(" "),e("h3",{attrs:{id:"系统部署信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#系统部署信息"}},[t._v("#")]),t._v(" 系统部署信息")]),t._v(" "),e("h4",{attrs:{id:"proxy配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#proxy配置"}},[t._v("#")]),t._v(" proxy配置")]),t._v(" "),e("p",[t._v("deployment："),e("code",[t._v("vsm-proxy-1527195965151313921180db78640anv8")])]),t._v(" "),e("p",[t._v("代码版本："),e("a",{attrs:{href:"http://git.koal.com/hs/kcsp/kcsp-temp-research/basecomponent/vsm/vsm-proxy.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("proxy-repo-sit213-branch"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("NodePort：")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9010")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9010")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodePort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30017")]),t._v("\n")])])]),e("p",[t._v("resources:")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2'")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1Gi\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1Gi\n")])])]),e("h4",{attrs:{id:"server配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#server配置"}},[t._v("#")]),t._v(" server配置")]),t._v(" "),e("p",[t._v("daemonSet:"),e("code",[t._v("scheduler-server")])]),t._v(" "),e("p",[t._v("代码版本："),e("a",{attrs:{href:"http://git.koal.com/hs/kcsp/kcsp-temp-research/basecomponent/vsm/scheduler-server.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("server-repo-sit213-branch"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("NodePort：")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" scheduler"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9020")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9020")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodePort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("32345")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" scheduler"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("server"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("internal\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9022")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("9022")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodePort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("65096")]),t._v("\n")])])]),e("p",[t._v("resources:")]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[t._v("          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("limits")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5'")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4Gi\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5'")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("memory")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 4Gi\n")])])]),e("h2",{attrs:{id:"★测试展示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#★测试展示"}},[t._v("#")]),t._v(" ★测试展示")]),t._v(" "),e("p",[t._v("本测试使用特定客户端，"),e("a",{attrs:{href:"http://git.koal.com/hs/kcsp/kcsp-temp-research/vsm/java.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码"),e("OutboundLink")],1),t._v("使用"),e("code",[t._v("all-in-one")]),t._v("分支。")]),t._v(" "),e("p",[t._v("样例接口：")]),t._v(" "),e("ul",[e("li",[e("p",[e("code",[t._v("genRandom")]),t._v("，生成随机数")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("GenerateKeyWithIpkEcc")]),t._v("，生成会话密钥，并使用内部ECC公钥加密输出")])]),t._v(" "),e("li",[e("p",[e("code",[t._v("InternalVerifyEcc")]),t._v("，内部密钥ECC验签")])])]),t._v(" "),e("h3",{attrs:{id:"配置1结果展示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置1结果展示"}},[t._v("#")]),t._v(" 配置1结果展示")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("循环轮次：10")])]),t._v(" "),e("li",[e("p",[t._v("单接口请求时长：60")])]),t._v(" "),e("li",[e("p",[t._v("模拟客户端数：64")])])]),t._v(" "),e("p",[e("strong",[t._v("说明")]),t._v("：多个轮次循环测试，可以避免单次测试的偶发性事件的影响，性能测试本质上一门统计性质的实验学，这里固定使用"),e("strong",[t._v("10次")]),t._v("。跑接口可能涉及到密码机或者proxy等系统的预热，短时间可能发无法发挥系统稳定后的能力，太长的时长则纯属浪费时间，根据以前多次测试密码机系统的经验30-90s是足够的，这里固定选取"),e("strong",[t._v("60s")]),t._v("。模拟客户端选取"),e("strong",[t._v("64")]),t._v("，三位密码机的连接池最佳值为该数值，这里盲选，本测试中将作为控制变量不断调整模拟客户端数，以期获取最佳连接数。")]),t._v(" "),e("p",[e("strong",[t._v("小结")]),t._v("：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("接口")]),t._v(" "),e("th",[t._v("QPS平均约值")]),t._v(" "),e("th",[t._v("平均latency")]),t._v(" "),e("th",[t._v("测试备注")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("genRandom")]),t._v(" "),e("td",[t._v("7713")]),t._v(" "),e("td",[t._v("8ms")]),t._v(" "),e("td",[t._v("10-60-64")])]),t._v(" "),e("tr",[e("td",[t._v("GenerateKeyWithIpkEcc")]),t._v(" "),e("td",[t._v("1031")]),t._v(" "),e("td",[t._v("62ms")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("InternalVerifyEcc")]),t._v(" "),e("td",[t._v("1776")]),t._v(" "),e("td",[t._v("36ms")]),t._v(" "),e("td")])])]),t._v(" "),e("p",[e("strong",[t._v("详情数据")]),t._v("：")]),t._v(" "),e("div",{staticClass:"language-textile extra-class"},[e("pre",{pre:!0,attrs:{class:"language-textile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token phrase"}},[t._v("fastTest genRandom successQps:7875 errorCount:0 successCount:472518 sendCount:472518 currentClient:100 avg(微妙) 12697\nfastTest genRandom successQps:7244 errorCount:0 successCount:434680 sendCount:434680 currentClient:100 avg(微妙) 13803\nfastTest genRandom successQps:8155 errorCount:0 successCount:489313 sendCount:489313 currentClient:100 avg(微妙) 12262\n...")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token phrase"}},[t._v("fastTest GenerateKeyWithIpkEcc successQps:1033 errorCount:0 successCount:62010 sendCount:62045 currentClient:100 avg(微妙) 96758\nfastTest GenerateKeyWithIpkEcc successQps:1035 errorCount:0 successCount:62118 sendCount:62145 currentClient:100 avg(微妙) 96590\nfastTest GenerateKeyWithIpkEcc successQps:1036 errorCount:0 successCount:62164 sendCount:62164 currentClient:100 avg(微妙) 96518\n...")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token phrase"}},[t._v("fastTest InternalVerifyEcc successQps:1770 errorCount:0 successCount:106239 sendCount:106239 currentClient:100 avg(微妙) 56476\nfastTest InternalVerifyEcc successQps:1780 errorCount:0 successCount:106839 sendCount:106839 currentClient:100 avg(微妙) 56159\nfastTest InternalVerifyEcc successQps:1777 errorCount:0 successCount:106620 sendCount:106620 currentClient:100 avg(微妙) 56274\n...\n")])])])]),e("p",[t._v("完整记录可参考"),e("code",[t._v("10.0.108.14")]),t._v("节点下"),e("code",[t._v("/home/ranni/nohup.out.10-64-60")]),t._v("文件")]),t._v(" "),e("h3",{attrs:{id:"配置二结果展示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置二结果展示"}},[t._v("#")]),t._v(" 配置二结果展示")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("循环轮次：10")])]),t._v(" "),e("li",[e("p",[t._v("单接口请求时长：60")])]),t._v(" "),e("li",[e("p",[t._v("模拟客户端数：100")])])]),t._v(" "),e("p",[e("strong",[t._v("说明")]),t._v("：模拟客户端作为控制变量，调整为100，如果测试数值有大幅提升，则可继续调高客户端数。如果没什么改变则说明密码机性能释放完毕，以后使用"),e("strong",[t._v("64")]),t._v("客户端为基准。")]),t._v(" "),e("p",[e("strong",[t._v("小结")]),t._v("：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("接口")]),t._v(" "),e("th",[t._v("QPS平均约值")]),t._v(" "),e("th",[t._v("平均latency")]),t._v(" "),e("th",[t._v("测试备注")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("genRandom")]),t._v(" "),e("td",[t._v("7733")]),t._v(" "),e("td",[t._v("13ms")]),t._v(" "),e("td",[t._v("10-60-100")])]),t._v(" "),e("tr",[e("td",[t._v("GenerateKeyWithIpkEcc")]),t._v(" "),e("td",[t._v("1032")]),t._v(" "),e("td",[t._v("97ms")]),t._v(" "),e("td")]),t._v(" "),e("tr",[e("td",[t._v("InternalVerifyEcc")]),t._v(" "),e("td",[t._v("1773")]),t._v(" "),e("td",[t._v("56ms")]),t._v(" "),e("td")])])]),t._v(" "),e("p",[t._v("对比"),e("code",[t._v("配置一")]),t._v("的结果，增加了模拟客户端数，QPS数值并没有显著改变，究其原因，是因为每次请求的时延变长了，可以理解为单台VSM的服务能力上限到此为止了。")]),t._v(" "),e("p",[t._v("测试数据不在展示了，完整记录可参考"),e("code",[t._v("10.0.108.14")]),t._v("下"),e("code",[t._v("/home/ranni/nohup.out.10-100-60")]),t._v("文件。")])])}),[],!1,null,null,null);s.default=r.exports}}]);