(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{428:function(a,s,t){"use strict";t.r(s);var e=t(62),r=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"单节点kafka的压力测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#单节点kafka的压力测试"}},[a._v("#")]),a._v(" 单节点kafka的压力测试")]),a._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#★配置条件"}},[a._v("★配置条件")]),t("ul",[t("li",[t("a",{attrs:{href:"#kafka配置"}},[a._v("kafka配置")])]),t("li",[t("a",{attrs:{href:"#zookeeper配置"}},[a._v("zookeeper配置")])])])]),t("li",[t("a",{attrs:{href:"#★压力测试"}},[a._v("★压力测试")]),t("ul",[t("li",[t("a",{attrs:{href:"#节点io测试"}},[a._v("节点IO测试")])]),t("li",[t("a",{attrs:{href:"#kafka生产消息测试"}},[a._v("kafka生产消息测试")])])])])])]),t("p"),a._v(" "),t("p",[a._v("以nfs为pv条件下，单broker kafka的压力测试")]),a._v(" "),t("h2",{attrs:{id:"★配置条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#★配置条件"}},[a._v("#")]),a._v(" ★配置条件")]),a._v(" "),t("h3",{attrs:{id:"kafka配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka配置"}},[a._v("#")]),a._v(" kafka配置")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("部署节点：k8s node节点——"),t("code",[a._v("10.0.108.12")])])]),a._v(" "),t("li",[t("p",[a._v("broker数量：1，单节点")])]),a._v(" "),t("li",[t("p",[a._v("垃圾收集器：G1，"),t("code",[a._v("-XX:+UseG1GC")])])]),a._v(" "),t("li",[t("p",[a._v("最大堆内存申请:1G，"),t("code",[a._v("-Xms1G")])])]),a._v(" "),t("li",[t("p",[a._v("持久化volume配置:")])])]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("capacity")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 20Gi\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("accessModes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ReadWriteMany\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("storageClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kafka"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("data\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("persistentVolumeReclaimPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" Retain\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nfs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" /data/k8s/kafka\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 10.0.108.11\n")])])]),t("h3",{attrs:{id:"zookeeper配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper配置"}},[a._v("#")]),a._v(" zookeeper配置")]),a._v(" "),t("p",[a._v("同样部署在k8s平台的12 node节点，与kafka使用同样的nfs服务。由于其只涉及到集群元信息的存储和broker调度，这里不相干，不在赘述。")]),a._v(" "),t("h2",{attrs:{id:"★压力测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#★压力测试"}},[a._v("#")]),a._v(" ★压力测试")]),a._v(" "),t("h3",{attrs:{id:"节点io测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#节点io测试"}},[a._v("#")]),a._v(" 节点IO测试")]),a._v(" "),t("p",[a._v("简单的测试节点的磁盘读写能力：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("hdparm -t --direct /dev/sda3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sync")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("time")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dd")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("if")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/dev/zero "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("of")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("test "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("bs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("512k "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("count")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("小结：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("使用"),t("code",[a._v("hdparm")]),a._v("测试读取，约"),t("code",[a._v("3760.79 MB/sec")]),a._v("。")])]),a._v(" "),t("li",[t("p",[a._v("使用dd测试写入能力,约"),t("code",[a._v("738 MB/s")]),a._v("。")])])]),a._v(" "),t("h3",{attrs:{id:"kafka生产消息测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kafka生产消息测试"}},[a._v("#")]),a._v(" kafka生产消息测试")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("kafka-producer-perf-test.sh --topic kcsplog --record-size "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("512")]),a._v(" --num-records "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100000")]),a._v(" --throughput -1 --producer-props bootstrap.servers"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("localhost:9092\n")])])]),t("p",[a._v("简单解释：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("记录大小：512kb")])]),a._v(" "),t("li",[t("p",[a._v("记录数：10万")])]),a._v(" "),t("li",[t("p",[a._v("不限流")])]),a._v(" "),t("li",[t("p",[a._v("pod内部测试，不走端口转发")])])]),a._v(" "),t("p",[a._v("结果:")]),a._v(" "),t("div",{staticClass:"language-textile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-textile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token phrase"}},[a._v("75093 records sent, 14338.9 records/sec (7.00 MB/sec), 916.3 ms avg latency, 2914.0 ms max latency.\n100000 records sent, 15651.901706 records/sec (7.64 MB/sec), 1638.13 ms avg latency, 3971.00 ms max latency, 656 ms 50th, 3907 ms 95th, 3961 ms 99th, 3969 ms 99.9th.\n")])])])]),t("ul",[t("li",[t("p",[a._v("最大吞吐量为"),t("code",[a._v("15651条/s")]),a._v("，"),t("code",[a._v("7MB/sec")])])]),a._v(" "),t("li",[t("p",[a._v("最低平均时延为"),t("code",[a._v("916ms")]),a._v("，最大时延"),t("code",[a._v("3971ms")])])])]),a._v(" "),t("p",[a._v("建议：内存可以适当加大到2~4G.")])])}),[],!1,null,null,null);s.default=r.exports}}]);